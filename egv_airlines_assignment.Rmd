---
title: "Tidying and Transforming Data"
author: "Escarlet Gabriel Vicente"
date: "2025-09-28"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
```

## 1. Introduction
In this assignment, I worked with flight delay data for two airlines across five cities.  
The goal was to tidy the dataset, transform it into long format, and compare on-time vs delayed flights both overall and by city.

---

## 2. Load Libraries
I started by loading the `tidyverse` package, which includes the tools for data manipulation and visualization.

```{r libraries}
library(tidyverse)
```

## 3. Create the Dataset

The assignment provided data in a table. Since I only had the raw numbers, I created the dataset manually in R.

```{r create_dataset}
delays <- data.frame(
  Airline = c("ALASKA", "ALASKA", "AM WEST", "AM WEST"),
  Status = c("on time", "delayed", "on time", "delayed"),
  Los.Angeles = c(497, 62, 694, 117),
  Phoenix = c(221, 12, 4840, 415),
  San.Diego = c(212, 20, 383, 65),
  San.Francisco = c(503, 102, 320, 129),
  Seattle = c(1841, 305, 201, 61)
)

delays
```


## 4. Check for Missing Data

I verified whether there were missing values in the dataset. Since there were none, no imputation was needed.

```{r verification}
sum(is.na(delays))
```

## 5. Transform Data

To make analysis easier, I reshaped the dataset into long format using pivot_longer().

```{r transformation}
delays_long <- delays %>%
  pivot_longer(cols = -c(Airline, Status),
               names_to = "City",
               values_to = "Count")

delays_long
```

## 6. Overall Percentages

Next, I calculated the overall percentages of on-time vs delayed flights for each airline.

```{r percentages}
overall <- delays_long %>%
  group_by(Airline, Status) %>%
  summarise(Total = sum(Count), .groups = "drop") %>%
  mutate(Percent = round(100 * Total / sum(Total), 1))

overall
```

**Explanation:**
Overall, Alaska Airlines had fewer delays in proportion compared to AM West. The imbalance is influenced by AM West’s large number of flights out of Phoenix.

## 7. Percentages by City

I then compared percentages of delays across the five cities.
```{r comparison}
by_city <- delays_long %>%
  group_by(Airline, City, Status) %>%
  summarise(Total = sum(Count), .groups = "drop") %>%
  group_by(City) %>%
  mutate(Percent = round(100 * Total / sum(Total), 1))

by_city
```

**Explanation:**
When broken down by city, Alaska performed better in Phoenix, but worse in Seattle. AM West looked worse overall because of its very high delay counts in Phoenix.

## 8. Analysis of Discrepancy

Comparing the overall results to the city-by-city breakdown reveals a discrepancy.

**City-by-city:** Alaska sometimes performs worse (Seattle).

**Overall:** AM West looks much worse.
This happens because Phoenix has so many AM West flights that its delay rate dominates the overall average.
This is an example of Simpson’s paradox, where aggregated data can give a misleading impression.

## 9. Conclusion

Through this analysis, I tidied the dataset, transformed it into a long format, and compared delay rates across airlines and cities.
The key insight is that while AM West appears worse overall, Alaska struggles in certain cities, showing the importance of looking at both aggregated and disaggregated data.